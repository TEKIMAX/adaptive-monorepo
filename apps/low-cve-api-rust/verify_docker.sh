#!/bin/bash
# Build the Docker image
docker build -t low-cve-api-rust .

# Run validation
# We use the key found in .env.local
export OLLAMA_API_KEY="c5f758681ad0454d97f9d15c021ba73b.Kvwle4MUNOJf8TOXTXyPXJF0"
export OLLAMA_BASE_URL="https://ollama.com"

echo "Running container with OLLAMA_BASE_URL=$OLLAMA_BASE_URL"

# Run container in background
docker run -d --name rust-api-test \
  -e OLLAMA_API_KEY=$OLLAMA_API_KEY \
  -e OLLAMA_BASE_URL=$OLLAMA_BASE_URL \
  -p 8080:8080 \
  low-cve-api-rust

# Wait for startup
sleep 2

# Test /v1/models
echo "Testing /v1/models..."
curl -v http://localhost:8080/v1/models

# Cleanup
docker stop rust-api-test
docker rm rust-api-test
