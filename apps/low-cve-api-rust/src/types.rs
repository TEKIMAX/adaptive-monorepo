use serde::{Deserialize, Serialize};


#[derive(Debug, Deserialize, Serialize, Clone)]
#[serde(tag = "type")]
pub enum InputItem {
    #[serde(rename = "message")]
    Message {
        role: String,
        content: InputContent,
    },
}

#[derive(Debug, Deserialize, Serialize, Clone)]
#[serde(untagged)]
pub enum InputContent {
    String(String),
    Parts(Vec<InputContentPart>),
}

#[derive(Debug, Deserialize, Serialize, Clone)]
#[serde(tag = "type")]
pub enum InputContentPart {
    #[serde(rename = "text")]
    Text { text: String },
    #[serde(rename = "input_text")]
    InputText { text: String },
}

#[derive(Debug, Deserialize)]
pub struct CreateResponseRequest {
    pub model: String,
    pub input: Vec<InputItem>,
    pub stream: Option<bool>,
    pub max_output_tokens: Option<u32>,
    pub temperature: Option<f32>,
}

// --- Output Events ---

#[derive(Debug, Serialize)]
#[serde(tag = "type")]
pub enum OpenResponseEvent {
    #[serde(rename = "response.in_progress")]
    ResponseInProgress { response: ResponseResource },
    #[serde(rename = "response.output_item.added")]
    OutputItemAdded {
        output_index: usize,
        item: OpenResponseItem,
        response_id: String,
    },
    #[serde(rename = "response.output_text.delta")]
    OutputTextDelta {
        item_id: String,
        output_index: usize,
        content_index: usize,
        delta: String,
        response_id: String,
    },
    #[serde(rename = "response.output_item.done")]
    OutputItemDone {
        output_index: usize,
        item: OpenResponseItem,
        response_id: String,
    },
    #[serde(rename = "response.completed")]
    ResponseCompleted { response: ResponseResource },
    #[serde(rename = "error")]
    Error { error: ErrorDetails },
}

#[derive(Serialize, Deserialize, Debug, Clone)]
pub struct Model {
    pub id: String,
    pub object: String, // "model"
    pub created: u64,
    pub owned_by: String,
}

#[derive(Serialize, Deserialize, Debug, Clone)]
pub struct ListModelsResponse {
    pub object: String, // "list"
    pub data: Vec<Model>,
}

#[derive(Debug, Serialize, Clone)]
pub struct ResponseResource {
    pub id: String,
    pub object: String,
    pub created_at: u64,
    pub status: String,
    pub model: String,
    pub output: Vec<OpenResponseItem>,
    #[serde(skip_serializing_if = "Option::is_none")]
    pub completed_at: Option<u64>,
    #[serde(skip_serializing_if = "Option::is_none")]
    pub metadata: Option<std::collections::HashMap<String, String>>,
}

#[derive(Debug, Serialize, Clone)]
#[serde(tag = "type")]
pub enum OpenResponseItem {
    #[serde(rename = "message")]
    Message {
        id: String,
        role: String,
        status: String,
        content: Vec<OutputContentPart>,
    },
}

#[derive(Debug, Serialize, Clone)]
#[serde(tag = "type")]
pub enum OutputContentPart {
    #[serde(rename = "output_text")]
    OutputText { text: String },
}

#[derive(Debug, Serialize)]
pub struct ErrorDetails {
    pub code: String,
    pub message: String,
}
