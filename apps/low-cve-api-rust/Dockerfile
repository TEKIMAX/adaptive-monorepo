# Build Stage
FROM cgr.dev/chainguard/rust:latest AS builder

WORKDIR /app
COPY --chown=nonroot:nonroot . .

# Build release binary
RUN cargo build --release

# Runtime Stage
# using glibc-dynamic to ensure compatibility if we link dynamically
FROM cgr.dev/chainguard/glibc-dynamic

WORKDIR /app
COPY --from=builder /app/target/release/low-cve-api-rust /usr/bin/low-cve-api-rust

# Expose port
EXPOSE 8080

# Environment variables
ENV PORT=8080
ENV RUST_LOG=info
ENV PORT=8080
ENV RUST_LOG=info
# Secrets injected at runtime by Cloudflare Worker


ENTRYPOINT ["/usr/bin/low-cve-api-rust"]
